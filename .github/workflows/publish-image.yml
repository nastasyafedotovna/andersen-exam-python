name: publish-image-to-ecr

on:
  workflow_run:
    workflows:
      - pylint-pytest-bandit
    types:
      - completed
    branches:
      - main


env:
  REGION: "eu-central-1"

jobs:
  publish:
    name: "publish docker image to ecr"
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
      name: Check out code

    - uses: mr-smithers-excellent/docker-build-push@v5
      name: Build & push Docker image
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        ECR_REGISTRY: "${{ secrets.ACCOUNT_NUMBER }}.dkr.ecr.${{ env.REGION }}.amazonaws.com"
        ECR_REPOSITORY: "nastasyafedotovna"
      with:
        image: $ECR_REPOSITORY
        tags: ${{ github.sha }}, latest
        registry: $ECR_REGISTRY
        dockerfile: Dockerfile

      
